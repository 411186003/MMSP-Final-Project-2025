name: MMSP JPEG Project CI

on:
  push:
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch test image (Kimberly.bmp)
        run: |
          curl -L -o Kimberly.bmp \
          https://raw.githubusercontent.com/cychiang-ntpu/mmsp-2025-final-jpeg/main/Kimberly.bmp

      - name: Build encoder / decoder
        run: |
          gcc -O2 -std=c11 -Wall -Wextra -o encoder encoder.c
          gcc -O2 -std=c11 -Wall -Wextra -o decoder decoder.c

      - name: Run Mode 0 (BMP split & rebuild)
        run: |
          ./encoder 0 Kimberly.bmp R.txt G.txt B.txt dim.txt
          ./decoder 0 ResKimberly.bmp R.txt G.txt B.txt dim.txt
          cmp Kimberly.bmp ResKimberly.bmp

      - name: Upload artifacts (Mode 0 outputs)
        uses: actions/upload-artifact@v4
        with:
          name: mode0-results
          path: |
            R.txt
            G.txt
            B.txt
            dim.txt
            ResKimberly.bmp
